<!doctype html>
<html lang="zh-cn" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-kong-api-gateway/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">General Deployment | Immutable Infrastructure as a Service</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://immutable-infrastructure.com/zh-cn/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://immutable-infrastructure.com/zh-cn/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://immutable-infrastructure.com/zh-cn/docs/kong-api-gateway/"><meta data-rh="true" property="og:locale" content="zh_cn"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-cn"><meta data-rh="true" name="docsearch:language" content="zh-cn"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="General Deployment | Immutable Infrastructure as a Service"><meta data-rh="true" name="description" content="[//]: # (Copyright 2024 Paion Data)"><meta data-rh="true" property="og:description" content="[//]: # (Copyright 2024 Paion Data)"><link data-rh="true" rel="icon" href="/zh-cn/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://immutable-infrastructure.com/zh-cn/docs/kong-api-gateway/"><link data-rh="true" rel="alternate" href="https://immutable-infrastructure.com/docs/kong-api-gateway/" hreflang="en"><link data-rh="true" rel="alternate" href="https://immutable-infrastructure.com/zh-cn/docs/kong-api-gateway/" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://immutable-infrastructure.com/docs/kong-api-gateway/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://11324Y7IH1-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Immutable Infrastructure as a Service" href="/zh-cn/opensearch.xml"><link rel="stylesheet" href="/zh-cn/assets/css/styles.aa7a5869.css">
<script src="/zh-cn/assets/js/runtime~main.ab6e57b6.js" defer="defer"></script>
<script src="/zh-cn/assets/js/main.89d86abd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-cn/"><div class="navbar__logo"><img src="/zh-cn/img/logo.svg" alt="Immutable Infrastructure Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zh-cn/img/logo.svg" alt="Immutable Infrastructure Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Immutable Infrastructure</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文（中国）</a><ul class="dropdown__menu"><li><a href="/docs/kong-api-gateway/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh-cn/docs/kong-api-gateway/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-cn">中文（中国）</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-cn/docs/intro">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/paion-data/immutable-infrastructure-as-a-service" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-icon-link header-github-link"> <svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-cn/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/zh-cn/docs/category/kong-api-gateway">Kong API Gateway</a><button aria-label="折叠侧边栏分类 &#x27;Kong API Gateway&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-cn/docs/kong-api-gateway/">General Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/kong-api-gateway/screwdriver-cd-deployment">Deployment via Screwdriver CD</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh-cn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh-cn/docs/category/kong-api-gateway"><span itemprop="name">Kong API Gateway</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">General Deployment</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Deploying Kong API Gateway</h1>
<p>hashicorp-aws deploys <a href="https://qubitpi.github.io/docs.konghq.com/gateway/latest/" target="_blank" rel="noopener noreferrer">Kong API Gateway</a> in the following way:</p>
<ul>
<li>Deploys <a href="https://qubitpi.github.io/docs.konghq.com/gateway/latest/" target="_blank" rel="noopener noreferrer">Kong API Gateway</a> in <strong>HTTP</strong> mode</li>
<li>Deploys a reverse proxy Nginx in front of the <a href="https://qubitpi.github.io/docs.konghq.com/gateway/latest/" target="_blank" rel="noopener noreferrer">Kong API Gateway</a> in the same EC2 to redirect all HTTPS request to
gateway&#x27;s
<a href="https://qubitpi.github.io/docs.konghq.com/gateway/latest/production/networking/default-ports/" target="_blank" rel="noopener noreferrer">corresponding</a> HTTP
ports</li>
</ul>
<p>The diagrams below illustrates the resulting deployment</p>
<p><img loading="lazy" alt="Error loading kong-deployment-diagram.png" src="/zh-cn/assets/images/kong-deployment-diagram-0e603dd1e4fb96d8c09f228e1ff31894.png" width="2778" height="728" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="general-deployments">General Deployments<a href="#general-deployments" class="hash-link" aria-label="General Deployments的直接链接" title="General Deployments的直接链接">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>Please complete the <a href="/zh-cn/docs/setup#setup">general setup</a> before proceeding.</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Supporting HTTPS Protocol</div><div class="admonitionContent_BuS1"><p>hashicorp-aws uses a <a href="https://github.com/QubitPi/docker-kong" target="_blank" rel="noopener noreferrer">customized fork of docker-kong</a> to
<a href="https://github.com/QubitPi/docker-kong/pull/1" target="_blank" rel="noopener noreferrer">fully separate the app and SSL</a>, and, therefore, the Nginx config needs
multiple <a href="https://www.nginx.com/resources/wiki/start/topics/examples/server_blocks/" target="_blank" rel="noopener noreferrer">servers</a>
to ensure all HTTPS ports are mapped to their corresponding HTTP ports as shown in the config snippet below:</p><div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>All relevant HTTP and HTTPS ports are listed in
<a href="https://qubitpi.github.io/docs.konghq.com/gateway/latest/production/networking/default-ports/" target="_blank" rel="noopener noreferrer">Kong&#x27;s documentation here</a>.
In general, our Nginx should **listen on an HTTPS port and <code>proxy_pass</code> to an HTTP port. For example, ports 8443 and
8444 are <code>proxy_pass</code>ed to 8000 and 8001, respectively, both of which are listed in the doc.</p><p>One special case is HTTP port 8000, which is the redirect port. hashicorp-aws maps the standard SSL 443 port to 8000 so
that any downstream (such as UI web app) simply needs to hit the domain without specifying port number and have its
request be reidrected to upstream services (such as database webservice)</p><p><img loading="lazy" alt="Error loading kong-ports-diagram.png" src="/zh-cn/assets/images/kong-ports-diagram-94dd812152799d6acdc342b76be0588a.png" width="1662" height="1064" class="img_ev3q"></p></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="defining-packer-variables">Defining Packer Variables<a href="#defining-packer-variables" class="hash-link" aria-label="Defining Packer Variables的直接链接" title="Defining Packer Variables的直接链接">​</a></h3>
<p>Create a <a href="https://qubitpi.github.io/hashicorp-packer/packer/guides/hcl/variables#from-a-file" target="_blank" rel="noopener noreferrer">HashiCorp Packer variable values file</a> named <strong>aws-kong.auto.pkrvars.hcl</strong> under
<strong><a href="https://github.com/QubitPi/hashicorp-aws/tree/master/hashicorp/kong-api-gateway/images" target="_blank" rel="noopener noreferrer">hashicorp-aws/hashicorp/kong-api-gateway/images</a></strong> directory with the following contents:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">hashicorp-aws/hashicorp/kong-api-gateway/images/aws-kong.auto.pkrvars.hcl</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ami_region              = &quot;us-east-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ami_name                = &quot;my-kong-ami&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance_type           = &quot;t2.small&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_cert_source         = &quot;/path/to/ssl.crt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_cert_key_source     = &quot;/path/to/ssl.key&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kong_api_gateway_domain = &quot;gateway.mycompany.com&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>ami_region</code> is the <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.RegionsAndAvailabilityZones.html#Concepts.RegionsAndAvailabilityZones.Availability" target="_blank" rel="noopener noreferrer">image region</a> where Kong API Gateway <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html" target="_blank" rel="noopener noreferrer">AMI</a> will be published to. The
published image will be <em>private</em></li>
<li><code>ami_name</code> is the published AMI name; it can be arbitrary</li>
<li><code>instance_type</code> is the <a href="https://aws.amazon.com/ec2/instance-types/" target="_blank" rel="noopener noreferrer">AWS EC2 instance type</a> running this image</li>
<li><code>ssl_cert_source</code> is the absolute path or the path relative to <a href="https://github.com/QubitPi/hashicorp-aws/tree/master/hashicorp/kong-api-gateway/images" target="_blank" rel="noopener noreferrer">hashicorp-aws/hashicorp/kong-api-gateway/images</a> of
the <a href="/zh-cn/docs/setup#optional-setup-ssl">SSL certificate file</a> for the Kong API Gateway domain</li>
<li><code>ssl_cert_key_source</code> is the absolute path or the path relative to <a href="https://github.com/QubitPi/hashicorp-aws/tree/master/hashicorp/kong-api-gateway/images" target="_blank" rel="noopener noreferrer">hashicorp-aws/hashicorp/kong-api-gateway/images</a> of the
<a href="/zh-cn/docs/setup#optional-setup-ssl">SSL certificate key file</a> for the Kong API Gateway domain</li>
<li><code>kong_api_gateway_domain</code> is the SSL-enabled domain that will serve the
<a href="https://qubitpi.github.io/docs.konghq.com/gateway/latest/production/networking/default-ports/" target="_blank" rel="noopener noreferrer">various ports of Kong gateway</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="defining-terraform-variables">Defining Terraform Variables<a href="#defining-terraform-variables" class="hash-link" aria-label="Defining Terraform Variables的直接链接" title="Defining Terraform Variables的直接链接">​</a></h3>
<p>Create a <a href="https://qubitpi.github.io/hashicorp-terraform/terraform/language/values/variables#variable-definitions-tfvars-files" target="_blank" rel="noopener noreferrer">HashiCorp Terraform variable values file</a> named <strong>aws-kong.auto.tfvars</strong> under
<strong><a href="https://github.com/QubitPi/hashicorp-aws/tree/master/hashicorp/kong-api-gateway/instances" target="_blank" rel="noopener noreferrer">hashicorp-aws/hashicorp/kong-api-gateway/instances</a></strong> directory with the following contents:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">hashicorp-aws/hashicorp/kong-api-gateway/instances/aws-kong.auto.tfvars</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws_deploy_region       = &quot;us-east-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ami_name                = &quot;my-kong-ami&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance_type           = &quot;t2.small&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance_name           = &quot;My Kong API Gateway&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">security_groups         = [&quot;My Kong API Gateway Security Group&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kong_api_gateway_domain = &quot;gateway.mycompany.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">route_53_zone_id        = &quot;MBS8YLKZML18VV2E8M8OK&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><code>aws_deploy_region</code> is the <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.RegionsAndAvailabilityZones.html#Concepts.RegionsAndAvailabilityZones.Availability" target="_blank" rel="noopener noreferrer">EC2 runtime region</a> where Kong will be deployed into</p>
</li>
<li>
<p><code>ami_name</code> is the name of the published AMI; <strong>it must be the same as the <code>ami_name</code> in
<a href="#defining-packer-variables">Packer variable file</a></strong></p>
</li>
<li>
<p><code>instance_type</code> is the chosen <a href="https://aws.amazon.com/ec2/instance-types/" target="_blank" rel="noopener noreferrer">AWS EC2 instance type</a> at runtime</p>
</li>
<li>
<p><code>instance_name</code> is the deployed EC2 name as appeared in the instance list of AWS console; it can be arbitrary</p>
</li>
<li>
<p><code>security_groups</code> is the list of <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-security-groups.html" target="_blank" rel="noopener noreferrer">AWS Security Group</a> <em>names</em> to associate with (yes, not ID, but name...)</p>
</li>
<li>
<p><code>kong_api_gateway_domain</code> is the SSL-enabled domain that will serve <a href="https://qubitpi.github.io/docs.konghq.com/gateway/latest/kong-manager/" target="_blank" rel="noopener noreferrer">Kong manager UI</a></p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>hashicorp-aws will bind a <em>private</em> IP address to this domain for the following reasons:</p><ul>
<li><a href="https://serverfault.com/a/967483" target="_blank" rel="noopener noreferrer">AWS security groups works for private IP only for DNS resolving</a>. Services
interacting with Kong gateway can use this domain.</li>
<li>In the case of internal access, for example administrators visiting Kong Manager for config purposes, people can
still use <code>https://public-dns:port</code></li>
</ul></div></div>
</li>
<li>
<p><code>route_53_zone_id</code> is the AWS Route 53 hosted Zone ID that hosts the domain <code>gateway.mycompany.com</code></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>To find the zone ID in AWS Route 53, we can:</p><ol>
<li>Sign in to the AWS Management Console</li>
<li>Open the Route 53 console at <a href="https://console.aws.amazon.com/route53/" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/route53/</a></li>
<li>Select Hosted zones in the navigation pane</li>
<li>Find the requested ID in the top level Hosted Zones summary in the Route 53 section</li>
</ol></div></div>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="building-ami-image">Building AMI Image<a href="#building-ami-image" class="hash-link" aria-label="Building AMI Image的直接链接" title="Building AMI Image的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> hashicorp-aws/hashicorp/kong-api-gateway/images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">packer init </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">packer validate </span><span class="token parameter variable" style="color:#36acaa">-var</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;skip_create_ami=true&quot;</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">packer build </span><span class="token parameter variable" style="color:#36acaa">-var</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;skip_create_ami=false&quot;</span><span class="token plain"> </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-to-ec2">Deploying to EC2<a href="#deploying-to-ec2" class="hash-link" aria-label="Deploying to EC2的直接链接" title="Deploying to EC2的直接链接">​</a></h3>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p>Depending on the <a href="#defining-packer-variables">AMI</a> and <a href="#defining-terraform-variables">EC2</a> configs, <strong>please be aware
AWS credit charges shall incur after the following commands execute</strong></p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/instances</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform validate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply -auto-approve</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-via-screwdriver-cd">Deployment via Screwdriver CD<a href="#deployment-via-screwdriver-cd" class="hash-link" aria-label="Deployment via Screwdriver CD的直接链接" title="Deployment via Screwdriver CD的直接链接">​</a></h2>
<p>hashicorp-aws supports deployment using <a href="/zh-cn/docs/kong-api-gateway/screwdriver-cd-deployment">Screwdriver CD</a>. Please check it out. <img src="https://github.com/QubitPi/QubitPi/blob/master/img/8%E5%A5%BD.gif?raw=true" height="40px"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-via-hacp">Deployment via HACP<a href="#deployment-via-hacp" class="hash-link" aria-label="Deployment via HACP的直接链接" title="Deployment via HACP的直接链接">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>Please try our HACP platform to deploy a Kong instance. It gives us one-click experience that helps us stand up an API
gateway in a minute.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/paion-data/immutable-infrastructure-as-a-service/tree/master/docs/docs/kong-api-gateway/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-cn/docs/category/kong-api-gateway"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Kong API Gateway</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-cn/docs/kong-api-gateway/screwdriver-cd-deployment"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Deployment via Screwdriver CD</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#general-deployments" class="table-of-contents__link toc-highlight">General Deployments</a><ul><li><a href="#defining-packer-variables" class="table-of-contents__link toc-highlight">Defining Packer Variables</a></li><li><a href="#defining-terraform-variables" class="table-of-contents__link toc-highlight">Defining Terraform Variables</a></li><li><a href="#building-ami-image" class="table-of-contents__link toc-highlight">Building AMI Image</a></li><li><a href="#deploying-to-ec2" class="table-of-contents__link toc-highlight">Deploying to EC2</a></li></ul></li><li><a href="#deployment-via-screwdriver-cd" class="table-of-contents__link toc-highlight">Deployment via Screwdriver CD</a></li><li><a href="#deployment-via-hacp" class="table-of-contents__link toc-highlight">Deployment via HACP</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-cn/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/paion-data/immutable-infrastructure-as-a-service/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/paion-data/immutable-infrastructure-as-a-service" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Paion Data. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>