<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-elk/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">General Deployment | Immutable Infrastructure as a Service</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://immutable-infrastructure.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://immutable-infrastructure.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://immutable-infrastructure.com/docs/elk/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_cn"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="General Deployment | Immutable Infrastructure as a Service"><meta data-rh="true" name="description" content="Operations and SRE teams can use [hashicorp-aws] to safely manage ELK deployment using infrastructure as code"><meta data-rh="true" property="og:description" content="Operations and SRE teams can use [hashicorp-aws] to safely manage ELK deployment using infrastructure as code"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://immutable-infrastructure.com/docs/elk/"><link data-rh="true" rel="alternate" href="https://immutable-infrastructure.com/docs/elk/" hreflang="en"><link data-rh="true" rel="alternate" href="https://immutable-infrastructure.com/zh-cn/docs/elk/" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://immutable-infrastructure.com/docs/elk/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://2BZ1ZIOLIM-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Immutable Infrastructure as a Service" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.d7c184ce.css">
<script src="/assets/js/runtime~main.5837d2c1.js" defer="defer"></script>
<script src="/assets/js/main.9b705a67.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_NPDn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Immutable Infrastructure Logo" class="themedComponent_GsY5 themedComponent--light_wNKK"><img src="/img/logo.svg" alt="Immutable Infrastructure Logo" class="themedComponent_GsY5 themedComponent--dark_o2KR"></div><b class="navbar__title text--truncate">Immutable Infrastructure</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_uhJS"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/elk/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-cn/docs/elk/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-cn">中文（中国）</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/paion-data/immutable-infrastructure-as-a-service" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-icon-link header-github-link"> <svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xzdb"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_RLbP colorModeToggle_ilFa"><button class="clean-btn toggleButton_DgdT toggleButtonDisabled_hp4Z" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_ldB0"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_lrJp"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Gn7Q"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_WVjd"><div class="docsWrapper_R3Xj"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton__A4G" type="button"></button><div class="docRoot_Dt3C"><aside class="theme-doc-sidebar-container docSidebarContainer_iqSu"><div class="sidebarViewport_ZWO_"><div class="sidebar_KSP0"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SoM2"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/setup">Setup</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/machine-learning">Machine Learning</a><button aria-label="Expand sidebar category &#x27;Machine Learning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/react-app">React App</a><button aria-label="Expand sidebar category &#x27;React App&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/kong-api-gateway">Kong API Gateway</a><button aria-label="Expand sidebar category &#x27;Kong API Gateway&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/webservice">Webservice</a><button aria-label="Expand sidebar category &#x27;Webservice&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/elk">ELK</a><button aria-label="Collapse sidebar category &#x27;ELK&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/elk/">General Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/elk/screwdriver-cd-deployment">Deployment via Screwdriver CD</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/docker-mailserver">Docker Mailserver</a><button aria-label="Expand sidebar category &#x27;Docker Mailserver&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/sonatype-nexus-repository">Sonatype Nexus Repository</a><button aria-label="Expand sidebar category &#x27;Sonatype Nexus Repository&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/troubleshooting">General Troubleshooting</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/adaptors">Adaptors</a><button aria-label="Expand sidebar category &#x27;Adaptors&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TEul"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_kCqU"><div class="docItemContainer_J_JV"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_ApK9" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_Lf7c"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/elk"><span itemprop="name">ELK</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">General Deployment</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_poYO theme-doc-toc-mobile tocMobile_fE4h"><button type="button" class="clean-btn tocCollapsibleButton__Tak">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>General Deployment</h1></header><p>Operations and SRE teams can use <a href="https://hashicorp-aws.com/" target="_blank" rel="noopener noreferrer">hashicorp-aws</a> to safely manage ELK deployment using infrastructure as code
methodology, which allows us to peer-reviewed infrastructure changes in an automated and controlled fashion.</p>
<div class="theme-admonition theme-admonition-info admonition_tY97 alert alert--info"><div class="admonitionHeading__1CX"><span class="admonitionIcon_fh12"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>What is the ELK Stack?</div><div class="admonitionContent_Sk5k"><p>The ELK stack is an acronym used to describe a stack that comprises three popular projects: <a href="https://qubitpi.github.io/elasticsearch/" target="_blank" rel="noopener noreferrer">Elasticsearch</a>,
<a href="https://qubitpi.github.io/logstash/" target="_blank" rel="noopener noreferrer">Logstash</a>, and <a href="https://qubitpi.github.io/kibana/" target="_blank" rel="noopener noreferrer">Kibana</a>. Often referred to as Elasticsearch, the ELK stack gives us the ability to aggregate logs from
all our systems and applications, analyze these logs, and create visualizations for application and infrastructure
monitoring, faster troubleshooting, security analytics, and more.</p></div></div>
<p><strong>Assuming ELK is a <em>non-frequently deployed</em> tech asset, <a href="https://hashicorp-aws.com/" target="_blank" rel="noopener noreferrer">hashicorp-aws</a> makes it a semi-automated deployment</strong>.</p>
<div class="theme-admonition theme-admonition-caution admonition_tY97 alert alert--warning"><div class="admonitionHeading__1CX"><span class="admonitionIcon_fh12"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_Sk5k"><p><a href="https://hashicorp-aws.com/" target="_blank" rel="noopener noreferrer">hashicorp-aws</a> deploys ELK as a <a href="https://aws.amazon.com/ec2/instance-types/t2/" target="_blank" rel="noopener noreferrer">t2.large</a> instance. This is because all
Elasticsearch, Kibana, and Logstash are contained in it, which can cause
<a href="https://stackoverflow.com/a/50022217" target="_blank" rel="noopener noreferrer">performance issue</a> in small instance. <em>t2.large</em>, by experiment, is the smallest
size that supports smooth runtime. For that, <strong>please be aware AWS credit charges shall incur afterward</strong></p></div></div>
<p>hashicorp-aws deploys ELK in the following way:</p>
<ul>
<li>Deploys all components of ELK in <strong>HTTP</strong> mode</li>
<li>Deploys a reverse proxy Nginx in front of the ELK in the same EC2 to redirect all HTTPS request to ELK&#x27;s
corresponding HTTP ports</li>
</ul>
<p>The diagram below illustrates the resulting deployment</p>
<p><img loading="lazy" alt="Error loading elk-deployment-diagram.png" src="/assets/images/elk-deployment-diagram-c6144ad9e3b78ea9e9a1b6ec8d3d3108.png" width="1404" height="994" class="img_oAxS"></p>
<h2 class="anchor anchorWithStickyNavbar_wJI4" id="general-deployments">General Deployments<a href="#general-deployments" class="hash-link" aria-label="Direct link to General Deployments" title="Direct link to General Deployments">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_tY97 alert alert--info"><div class="admonitionHeading__1CX"><span class="admonitionIcon_fh12"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_Sk5k"><p>Please complete the <a href="/docs/setup#setup">general setup</a> before proceeding.</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_tY97 alert alert--success"><div class="admonitionHeading__1CX"><span class="admonitionIcon_fh12"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Supporting HTTPS Protocol</div><div class="admonitionContent_Sk5k"><p>We offer a <a href="/docs/setup#optional-setup-ssl">Nginx config file</a> template.
<a href="https://github.com/QubitPi/hashicorp-aws/blob/master/hashicorp/elk/images/nginx-ssl.conf" target="_blank" rel="noopener noreferrer">This template</a> will be used
by hashicorp-aws by default</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_wJI4" id="defining-packer-variables">Defining Packer Variables<a href="#defining-packer-variables" class="hash-link" aria-label="Direct link to Defining Packer Variables" title="Direct link to Defining Packer Variables">​</a></h3>
<p>Create a <a href="https://packer.qubitpi.org/packer/guides/hcl/variables#from-a-file" target="_blank" rel="noopener noreferrer">HashiCorp Packer variable values file</a> named <strong>aws-elk.pkrvars.hcl</strong> under
<strong><a href="https://github.com/QubitPi/hashicorp-aws/tree/master/hashicorp/elk/images" target="_blank" rel="noopener noreferrer">hashicorp-aws/hashicorp/elk/images</a></strong> with the following contents:</p>
<div class="language-hcl codeBlockContainer_TDoR theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_xs8w">hashicorp-aws/hashicorp/elk/images/aws-elk.auto.pkrvars.hcl</div><div class="codeBlockContent_x6xf"><pre tabindex="0" class="prism-code language-hcl codeBlock_gLku thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_V3Je"><span class="token-line" style="color:#393A34"><span class="token plain">ami_region             = &quot;us-east-2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ami_name               = &quot;my-elk-ami&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_cert_file_path     = &quot;/path/to/ssl.crt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_cert_key_file_path = &quot;/path/to/ssl.key&quot;</span><br></span></code></pre><div class="buttonGroup_fNPX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_C63X" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_s2ZO"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_fDmj"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>ami_region</code> is the <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.RegionsAndAvailabilityZones.html#Concepts.RegionsAndAvailabilityZones.Availability" target="_blank" rel="noopener noreferrer">region</a> where ELK <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html" target="_blank" rel="noopener noreferrer">AMI</a> will be published to. The published image will be
<em>private</em></li>
<li><code>ami_name</code> is the published <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html" target="_blank" rel="noopener noreferrer">AMI</a> name; it can be arbitrary</li>
<li><code>ssl_cert_file_path</code> is the absolute path or the path relative to <a href="https://github.com/QubitPi/hashicorp-aws/tree/master/hashicorp/elk/images" target="_blank" rel="noopener noreferrer">hashicorp-aws/hashicorp/elk/images</a> of
the <a href="/docs/setup#optional-setup-ssl">SSL certificate file</a> for the domain serving the ELK EC2 instance</li>
<li><code>ssl_cert_key_file_path</code>  is the absolute path or the path relative to <a href="https://github.com/QubitPi/hashicorp-aws/tree/master/hashicorp/elk/images" target="_blank" rel="noopener noreferrer">hashicorp-aws/hashicorp/elk/images</a> of the <a href="/docs/setup#optional-setup-ssl">SSL certificate key file</a> for the domain serving the ELK EC2 instance</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_wJI4" id="defining-terraform-variables">Defining Terraform Variables<a href="#defining-terraform-variables" class="hash-link" aria-label="Direct link to Defining Terraform Variables" title="Direct link to Defining Terraform Variables">​</a></h3>
<p>Create a <a href="https://terraform.qubitpi.org/terraform/language/values/variables#variable-definitions-tfvars-files" target="_blank" rel="noopener noreferrer">HashiCorp Terraform variable values file</a> named <strong>aws-elk.tfvars</strong> under
**<a href="https://github.com/QubitPi/hashicorp-aws/tree/master/hashicorp/elk/instances" target="_blank" rel="noopener noreferrer">hashicorp-aws/hashicorp/elk/instances</a>**with the following contents:</p>
<div class="language-hcl codeBlockContainer_TDoR theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_xs8w">hashicorp-aws/hashicorp/elk/instances/aws-elk.auto.tfvars</div><div class="codeBlockContent_x6xf"><pre tabindex="0" class="prism-code language-hcl codeBlock_gLku thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_V3Je"><span class="token-line" style="color:#393A34"><span class="token plain">aws_ec2_region = &quot;us-east-2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ami_name          = &quot;my-elk-ami&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance_name     = &quot;My ELK instance&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key_pair_name     = &quot;My AWS keypair name&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">security_groups   = [&quot;My ELK Security Group&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">elk_domain         = &quot;myelk.mycompany.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">route_53_zone_id  = &quot;9DQXLTNSN7ZX9P8V2KZII&quot;</span><br></span></code></pre><div class="buttonGroup_fNPX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_C63X" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_s2ZO"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_fDmj"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><code>aws_ec2_region</code> is the <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.RegionsAndAvailabilityZones.html#Concepts.RegionsAndAvailabilityZones.Availability" target="_blank" rel="noopener noreferrer">EC2 runtime region</a> where ELK EC2 instance will be deployed into</p>
</li>
<li>
<p><code>ami_name</code> is the name of the published AMI; <strong>it must be the same as the <code>ami_name</code> in
<a href="#defining-packer-variables">Packer variable file</a></strong></p>
</li>
<li>
<p><code>instance_name</code> is the deployed EC2 name as appeared in the instance list of AWS console; it can be arbitrary</p>
</li>
<li>
<p><code>key_pair_name</code> is the name of
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html" target="_blank" rel="noopener noreferrer">AWS EC2 key pair</a> bound to this ELK instance.
We will use this key pair to later ssh into the ELK to for <a href="#post-setup-in-ec2-instance">post setup discussed below</a></p>
</li>
<li>
<p><code>security_groups</code> is the list of <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-security-groups.html" target="_blank" rel="noopener noreferrer">AWS Security Group</a> <em>names</em> to associate with (yes, not ID, but name...)</p>
</li>
<li>
<p><code>elk_domain</code> is the SSL-enabled domain that will serve various ELK endpoints, such as its API and <a href="https://qubitpi.github.io/kibana/" target="_blank" rel="noopener noreferrer">Kibana UI</a></p>
<div class="theme-admonition theme-admonition-warning admonition_tY97 alert alert--warning"><div class="admonitionHeading__1CX"><span class="admonitionIcon_fh12"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_Sk5k"><p>hashicorp-aws will bind a <em>private</em> IP address to this domain for the following reasons:</p><ul>
<li><a href="https://serverfault.com/a/967483" target="_blank" rel="noopener noreferrer">AWS security groups works for private IP only for DNS resolving</a>. Services
sending logs to ELK can use this domain.</li>
<li>In the case of internal access, for example developers visiting Kibana UI for debugging purposes, people can still
use <code>https://public-dns:port</code></li>
</ul></div></div>
</li>
<li>
<p><code>route_53_zone_id</code> is the AWS Route 53 hosted Zone ID that hosts the domain &quot;myelk.mycompany.com&quot;</p>
<div class="theme-admonition theme-admonition-tip admonition_tY97 alert alert--success"><div class="admonitionHeading__1CX"><span class="admonitionIcon_fh12"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_Sk5k"><p>To find the zone ID in AWS Route 53, we can:</p><ol>
<li>Sign in to the AWS Management Console</li>
<li>Open the Route 53 console at <a href="https://console.aws.amazon.com/route53/" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/route53/</a></li>
<li>Select Hosted zones in the navigation pane</li>
<li>Find the requested ID in the top level Hosted Zones summary in the Route 53 section</li>
</ol></div></div>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_wJI4" id="building-ami-image">Building AMI Image<a href="#building-ami-image" class="hash-link" aria-label="Direct link to Building AMI Image" title="Direct link to Building AMI Image">​</a></h3>
<div class="language-console codeBlockContainer_TDoR theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x6xf"><pre tabindex="0" class="prism-code language-console codeBlock_gLku thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_V3Je"><span class="token-line" style="color:#393A34"><span class="token plain">cd hashicorp-aws/hashicorp/elk/images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">packer init .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">packer validate -var &quot;skip_create_ami=true&quot; .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">packer build -var &quot;skip_create_ami=false&quot; .</span><br></span></code></pre><div class="buttonGroup_fNPX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_C63X" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_s2ZO"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_fDmj"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Record the <strong>Elasticsearch password (for <em>elastic</em> user)</strong> at command line prompt. For example</p>
<div class="language-shell codeBlockContainer_TDoR theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x6xf"><pre tabindex="0" class="prism-code language-shell codeBlock_gLku thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_V3Je"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> install-elk.amazon-ebs.elk: + </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> /usr/share/elasticsearch/bin/elasticsearch-reset-password </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> elastic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> install-elk.amazon-ebs.elk: + </span><span class="token function" style="color:#d73a49">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    install-elk.amazon-ebs.elk: This tool will reset the password of the </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">elastic</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> user to an autogenerated value.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    install-elk.amazon-ebs.elk: The password will be printed </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the console.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    install-elk.amazon-ebs.elk:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    install-elk.amazon-ebs.elk:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    install-elk.amazon-ebs.elk: Password </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">elastic</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> user successfully reset.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    install-elk.amazon-ebs.elk: New value: </span><span class="token assign-left variable" style="color:#36acaa">dsrg34IKHU787iud</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dio</span><br></span></code></pre><div class="buttonGroup_fNPX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_C63X" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_s2ZO"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_fDmj"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this case, the password is <strong>dsrg34IKHU787iud=dio</strong> which is shown in the last line of the output above. <strong>We will be
using this password in later steps</strong> so please keep it securely</p>
<h3 class="anchor anchorWithStickyNavbar_wJI4" id="deploying-to-ec2">Deploying to EC2<a href="#deploying-to-ec2" class="hash-link" aria-label="Direct link to Deploying to EC2" title="Direct link to Deploying to EC2">​</a></h3>
<div class="theme-admonition theme-admonition-caution admonition_tY97 alert alert--warning"><div class="admonitionHeading__1CX"><span class="admonitionIcon_fh12"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_Sk5k"><p>Depending on the <a href="#defining-packer-variables">AMI</a> and <a href="#defining-terraform-variables">EC2</a> configs, <strong>please be aware
AWS credit charges shall incur after the following commands execute</strong></p></div></div>
<div class="language-console codeBlockContainer_TDoR theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x6xf"><pre tabindex="0" class="prism-code language-console codeBlock_gLku thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_V3Je"><span class="token-line" style="color:#393A34"><span class="token plain">cd ../instances/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform validate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply -auto-approve</span><br></span></code></pre><div class="buttonGroup_fNPX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_C63X" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_s2ZO"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_fDmj"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_wJI4" id="post-setup-in-ec2-instance">Post Setup in EC2 Instance<a href="#post-setup-in-ec2-instance" class="hash-link" aria-label="Direct link to Post Setup in EC2 Instance" title="Direct link to Post Setup in EC2 Instance">​</a></h3>
<p>As we&#x27;ve mentioned in the beginning, this is a semi-deployment and we still need to SSH into the box to manually
generate Kibana token &amp; verification code. This will make the automated deployment logic simple and easy to maintain</p>
<div class="language-bash codeBlockContainer_TDoR theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x6xf"><pre tabindex="0" class="prism-code language-bash codeBlock_gLku thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_V3Je"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token </span><span class="token parameter variable" style="color:#36acaa">--scope</span><span class="token plain"> kibana </span><span class="token parameter variable" style="color:#36acaa">--url</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://localhost:9200&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> /usr/share/kibana/bin/kibana-verification-code</span><br></span></code></pre><div class="buttonGroup_fNPX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_C63X" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_s2ZO"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_fDmj"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now we can visit <code>https://public-dns:port</code> to enter the token and verification code to access our ELK instance.</p>
<h4 class="anchor anchorWithStickyNavbar_wJI4" id="logstash">Logstash<a href="#logstash" class="hash-link" aria-label="Direct link to Logstash" title="Direct link to Logstash">​</a></h4>
<p>Logstash, at this moment, supports redirecting log lines from Filebeat to Elasticsearch and, similar to the
token and verification above, needs to be setup manually.</p>
<p>Create a file named <strong>logstash-filebeat.conf</strong> in the default location chosen by Logstash:</p>
<div class="language-bash codeBlockContainer_TDoR theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x6xf"><pre tabindex="0" class="prism-code language-bash codeBlock_gLku thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_V3Je"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">nano</span><span class="token plain"> /usr/share/logstash/logstash-filebeat.conf</span><br></span></code></pre><div class="buttonGroup_fNPX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_C63X" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_s2ZO"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_fDmj"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Copy and paste the following contents into the file</p>
<div class="theme-admonition theme-admonition-info admonition_tY97 alert alert--info"><div class="admonitionHeading__1CX"><span class="admonitionIcon_fh12"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_Sk5k"><p>Replace the <code>&lt;password for user &#x27;elastic&#x27;&gt;</code> accordingly. If the user is <em>elastic</em>, which is the case here, the password
has been generated during the <a href="#building-ami-image">AMI image building phase</a></p></div></div>
<div class="language-text codeBlockContainer_TDoR theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x6xf"><pre tabindex="0" class="prism-code language-text codeBlock_gLku thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_V3Je"><span class="token-line" style="color:#393A34"><span class="token plain">input {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    beats {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port =&gt; &quot;5044&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    elasticsearch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hosts =&gt; [ &quot;https://localhost:9200&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ssl_certificate_verification =&gt; false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        user =&gt; &quot;elastic&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        password =&gt; &quot;&lt;password for user &#x27;elastic&#x27;&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_fNPX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_C63X" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_s2ZO"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_fDmj"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Start Logstash with:</p>
<div class="language-bash codeBlockContainer_TDoR theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x6xf"><pre tabindex="0" class="prism-code language-bash codeBlock_gLku thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_V3Je"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> /usr/share/logstash/bin/logstash </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> logstash-filebeat.conf </span><span class="token parameter variable" style="color:#36acaa">--config.reload.automatic</span><br></span></code></pre><div class="buttonGroup_fNPX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_C63X" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_s2ZO"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_fDmj"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>or with nohup at background:</p>
<div class="language-bash codeBlockContainer_TDoR theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x6xf"><pre tabindex="0" class="prism-code language-bash codeBlock_gLku thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_V3Je"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">nohup</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> /usr/share/logstash/bin/logstash </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> logstash-filebeat.conf </span><span class="token parameter variable" style="color:#36acaa">--config.reload.automatic</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><br></span></code></pre><div class="buttonGroup_fNPX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_C63X" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_s2ZO"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_fDmj"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_wJI4" id="deployment-via-screwdriver-cd">Deployment via Screwdriver CD<a href="#deployment-via-screwdriver-cd" class="hash-link" aria-label="Direct link to Deployment via Screwdriver CD" title="Direct link to Deployment via Screwdriver CD">​</a></h2>
<p>hashicorp-aws also support deployment using <a href="https://qubitpi.github.io/screwdriver-cd-homepage/" target="_blank" rel="noopener noreferrer">Screwdriver CD</a> with this <a href="https://github.com/QubitPi/elk-release-definition-template" target="_blank" rel="noopener noreferrer">elk-release-definition-template</a></p>
<h2 class="anchor anchorWithStickyNavbar_wJI4" id="deployment-via-github-actions">Deployment via GitHub Actions<a href="#deployment-via-github-actions" class="hash-link" aria-label="Direct link to Deployment via GitHub Actions" title="Direct link to Deployment via GitHub Actions">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_wJI4" id="deployment-via-hacp">Deployment via HACP<a href="#deployment-via-hacp" class="hash-link" aria-label="Direct link to Deployment via HACP" title="Direct link to Deployment via HACP">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_tY97 alert alert--success"><div class="admonitionHeading__1CX"><span class="admonitionIcon_fh12"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_Sk5k"><p>Please try our HACP platform to deploy an ELK instance. It gives us one-click experience that helps us stand up ELK in
a minute.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/paion-data/immutable-infrastructure-as-a-service/tree/master/docs/docs/elk/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_P9PK" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_w4J7"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/elk"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ELK</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/elk/screwdriver-cd-deployment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deployment via Screwdriver CD</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_lhgC thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#general-deployments" class="table-of-contents__link toc-highlight">General Deployments</a><ul><li><a href="#defining-packer-variables" class="table-of-contents__link toc-highlight">Defining Packer Variables</a></li><li><a href="#defining-terraform-variables" class="table-of-contents__link toc-highlight">Defining Terraform Variables</a></li><li><a href="#building-ami-image" class="table-of-contents__link toc-highlight">Building AMI Image</a></li><li><a href="#deploying-to-ec2" class="table-of-contents__link toc-highlight">Deploying to EC2</a></li><li><a href="#post-setup-in-ec2-instance" class="table-of-contents__link toc-highlight">Post Setup in EC2 Instance</a></li></ul></li><li><a href="#deployment-via-screwdriver-cd" class="table-of-contents__link toc-highlight">Deployment via Screwdriver CD</a></li><li><a href="#deployment-via-github-actions" class="table-of-contents__link toc-highlight">Deployment via GitHub Actions</a></li><li><a href="#deployment-via-hacp" class="table-of-contents__link toc-highlight">Deployment via HACP</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/paion-data/immutable-infrastructure-as-a-service/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xzdb"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/paion-data/immutable-infrastructure-as-a-service" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xzdb"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Paion Data. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>